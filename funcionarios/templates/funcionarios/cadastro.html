{% extends 'base.html' %}
{% load static %}

{% block title %}Cadastro de Funcionário{% endblock %}

{% block content %}

<style>
    .container-cadastro {
        max-width: 900px;
        margin: auto;
        padding: 20px;
        border: 2px solid #000;
        border-radius: 10px;
        background-color: #f8f9fa;
    }

    .titulo-cadastro {
        text-align: center;
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 20px;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-control {
        border: 2px solid black !important; /* Força a borda preta nos inputs do Bootstrap */
    }

    label {
        font-weight: bold;
    }

    input, select, textarea {
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        border: 2px solid black !important;
        background-color: white !important;
        box-shadow: none !important;
    }

    .box-secao {
        background-color: #03396e;
        color: white;
        padding: 10px;
        font-weight: bold;
        text-align: center;
        border-radius: 5px;
        margin-bottom: 10px;
    }

    .foto-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        margin-bottom: 20px;
    }

    .foto-preview {
        width: 140px;
        height: 140px;
        object-fit: cover;
        border-radius: 10px;
        border: 2px solid black;
        box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
        margin-bottom: 10px;
        display: block;
    }

    .foto-placeholder {
        width: 140px;
        height: 140px;
        border-radius: 10px;
        background-color: #ddd;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 50px;
        color: #777;
        border: 2px solid black;
    }

    .foto-botoes {
        margin-top: 10px;
    }

    .btn {
        padding: 10px 15px;
        border-radius: 5px;
        font-weight: bold;
        text-align: center;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
        border: none;
        cursor: pointer;
        transition: 0.3s;
        justify-content: center;
        height: 45px;
    }

    .btn-azul {
        background-color: #03396e;
        color: white;
    }

    .btn-verde {
        background-color: #28a745;
        color: white;
        width: 100%;
    }

    #id_foto {
        display: none;
    }

</style>

<div class="container-cadastro">
    <div class="titulo-cadastro">Cadastro de Funcionário</div>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="box-secao">Foto do Funcionário</div>
        <div class="foto-container">
            <div class="foto-preview-container">
                <img id="foto-preview" class="foto-preview" src="{% if form.foto.value %}{{ form.foto.url }}{% else %}{% static 'images/user-placeholder.png' %}{% endif %}" alt="Foto do Funcionário">
            </div>

            <div class="foto-botoes">
                <label for="id_foto" class="btn btn-azul">
                    <i class="fas fa-upload"></i> <span id="foto-label">Adicionar Foto</span>
                </label>
                <input type="file" id="id_foto" name="foto" accept="image/*">
            </div>
        </div>

        <div class="box-secao">Dados Pessoais</div>
        <div class="form-group">
            <label for="{{ form.nome_completo.id_for_label }}">Nome Completo</label>
            {{ form.nome_completo }}
        </div>
        <div class="form-group">
            <label for="{{ form.cpf.id_for_label }}">CPF</label>
            {{ form.cpf }}
        </div>
        <div class="form-group">
            <label for="{{ form.rg.id_for_label }}">RG</label>
            {{ form.rg }}
        </div>
        <div class="form-group">
            <label for="{{ form.sexo.id_for_label }}">Sexo</label>
            {{ form.sexo }}
        </div>
        <div class="form-group">
            <label for="{{ form.data_nascimento.id_for_label }}">Data de Nascimento</label>
            {{ form.data_nascimento }}
        </div>
        <div class="form-group">
            <label for="idade">Idade</label>
            <input type="text" id="idade" class="form-control" disabled>
        </div>
        <div class="form-group">
            <label for="{{ form.cnh.id_for_label }}">CNH</label>
            {{ form.cnh }}
        </div>
        <div class="form-group">
            <label for="{{ form.validade_cnh.id_for_label }}">Validade da CNH</label>
            {{ form.validade_cnh }}
        </div>
        <div class="form-group">
            <label for="{{ form.contato_pessoal.id_for_label }}">Contato Pessoal</label>
            {{ form.contato_pessoal }}
        </div>
        <div class="form-group">
            <label for="{{ form.contato_emergencia.id_for_label }}">Contato de Emergência</label>
            {{ form.contato_emergencia }}
        </div>
        <div class="form-group">
            <label for="{{ form.email.id_for_label }}">Email</label>
            {{ form.email }}
        </div>

        <div class="box-secao">Dados Profissionais</div>
        <div class="form-group">
            <label for="{{ form.id_funcionario.id_for_label }}">ID do Funcionário</label>
            {{ form.id_funcionario }}
        </div>
        <div class="form-group">
            <label for="{{ form.funcao.id_for_label }}">Função</label>
            {{ form.funcao }}
        </div>
        <div class="form-group">
            <label for="{{ form.departamento.id_for_label }}">Departamento</label>
            {{ form.departamento }}
        </div>
        <div class="form-group">
            <label for="{{ form.status.id_for_label }}">Status</label>
            {{ form.status }}
        </div>
        <div class="form-group">
            <label for="{{ form.data_admissao.id_for_label }}">Data de Admissão</label>
            {{ form.data_admissao }}
        </div>
        <div class="form-group">
            <label for="{{ form.data_mobilizacao.id_for_label }}">Data de Mobilização</label>
            {{ form.data_mobilizacao }}
        </div>
        <div class="form-group">
            <label for="{{ form.data_desligamento.id_for_label }}">Data de Desligamento</label>
            {{ form.data_desligamento }}
        </div>
        <div class="form-group">
            <label for="{{ form.data_desmobilizacao.id_for_label }}">Data de Desmobilização</label>
            {{ form.data_desmobilizacao }}
        </div>
        <div class="form-group">
            <label for="{{ form.cracha_vale.id_for_label }}">Crachá Vale</label>
            {{ form.cracha_vale }}
        </div>

        <button type="submit" class="btn btn-verde mt-3">Cadastrar Funcionário</button>
    </form>
</div>

<script>
    document.getElementById("id_foto").addEventListener("change", function (event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById("foto-preview").src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });

    // Máscara automática para CPF
    document.getElementById('{{ form.cpf.auto_id }}').addEventListener('input', function (e) {
        let value = e.target.value.replace(/\D/g, ''); // Remove tudo que não for número
        if (value.length > 11) value = value.slice(0, 11); // Limita a 11 dígitos

        if (value.length > 9) {
            e.target.value = value.replace(/^(\d{3})(\d{3})(\d{3})(\d{1,2})$/, "$1.$2.$3-$4");
        } else if (value.length > 6) {
            e.target.value = value.replace(/^(\d{3})(\d{3})(\d{1,3})$/, "$1.$2.$3");
        } else if (value.length > 3) {
            e.target.value = value.replace(/^(\d{3})(\d{1,3})$/, "$1.$2");
        } else {
            e.target.value = value;
        }
    });

    // Atualiza a idade ao inserir a data de nascimento
    document.getElementById('{{ form.data_nascimento.auto_id }}').addEventListener('change', function () {
        let nascimento = new Date(this.value);
        let hoje = new Date();
        let idade = hoje.getFullYear() - nascimento.getFullYear();
        if (hoje.getMonth() < nascimento.getMonth() || (hoje.getMonth() === nascimento.getMonth() && hoje.getDate() < nascimento.getDate())) {
            idade--;
        }
        document.getElementById('idade').value = idade;
    });
</script>

{% endblock %}