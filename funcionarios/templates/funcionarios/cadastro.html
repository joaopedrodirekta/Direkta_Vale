{% extends 'base.html' %}
{% load static %}

{% block title %}Cadastro de Funcionário{% endblock %}

{% block content %}

<style>
    .container-cadastro {
        max-width: 900px;
        margin: auto;
        padding: 20px;
        border: 2px solid #000;
        border-radius: 10px;
        background-color: #f8f9fa;
    }

    .titulo-cadastro {
        text-align: center;
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 20px;
    }

    .form-group {
        margin-bottom: 15px;
    }

    label {
        font-weight: bold;
    }

    input, select {
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .box-secao {
        background-color: #03396e;
        color: white;
        padding: 10px;
        font-weight: bold;
        text-align: center;
        border-radius: 5px;
        margin-bottom: 10px;
    }

    .foto-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        margin-bottom: 20px;
    }

    .foto-preview {
        width: 140px;
        height: 140px;
        object-fit: cover;
        border-radius: 10px;
        border: 2px solid black;
        box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
        margin-bottom: 10px;
        display: none;
    }

    .foto-placeholder {
        font-size: 120px;
        color: #ccc;
        display: block;
    }

    .foto-botoes {
        display: flex;
        gap: 15px;
        margin-top: 10px;
        justify-content: center;
    }

    .btn {
        padding: 10px 15px;
        border-radius: 5px;
        font-weight: bold;
        text-align: center;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
        border: none;
        cursor: pointer;
        transition: 0.3s;
        min-width: 180px;
        justify-content: center;
        height: 45px;
    }

    .btn-azul {
        background-color: #03396e;
        color: white;
    }

    .btn-verde {
        background-color: #28a745;
        color: white;
        width: 100%;
    }

</style>

<div class="container-cadastro">
    <div class="titulo-cadastro">Cadastro de Funcionário</div>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="box-secao">Foto do Funcionário</div>
        <div class="foto-container">
            <div class="foto-preview-container">
                <img id="foto-preview" class="foto-preview" src="{% static 'images/user-placeholder.png' %}" alt="Foto do Funcionário">
                <i id="foto-icon" class="fas fa-user-circle foto-placeholder"></i>
            </div>
        
            <div class="foto-botoes">
                <label for="id_foto" class="btn btn-azul">
                    <i class="fas fa-upload"></i> <span id="foto-label">Adicionar Foto</span>
                </label>
                {{ form.foto }}
            </div>
        </div>

        <div class="box-secao">Dados Pessoais</div>
        <div class="form-group">
            <label for="{{ form.nome_completo.id_for_label }}">Nome Completo</label>
            {{ form.nome_completo }}
        </div>
        <div class="form-group">
            <label for="{{ form.cpf.id_for_label }}">CPF</label>
            {{ form.cpf }}
        </div>
        <div class="form-group">
            <label for="{{ form.rg.id_for_label }}">RG</label>
            {{ form.rg }}
        </div>
        <div class="form-group">
            <label for="{{ form.sexo.id_for_label }}">Sexo</label>
            {{ form.sexo }}
        </div>
        <div class="form-group">
            <label for="{{ form.data_nascimento.id_for_label }}">Data de Nascimento</label>
            {{ form.data_nascimento }}
        </div>
        <div class="form-group">
            <label for="idade">Idade</label>
            <input type="text" id="idade" class="form-control" disabled>
        </div>
        <div class="form-group">
            <label for="{{ form.cnh.id_for_label }}">CNH</label>
            {{ form.cnh }}
        </div>
        <div class="form-group">
            <label for="{{ form.validade_cnh.id_for_label }}">Validade da CNH</label>
            {{ form.validade_cnh }}
        </div>
        <div class="form-group">
            <label for="{{ form.contato_pessoal.id_for_label }}">Contato Pessoal</label>
            {{ form.contato_pessoal }}
        </div>
        <div class="form-group">
            <label for="{{ form.contato_emergencia.id_for_label }}">Contato de Emergência</label>
            {{ form.contato_emergencia }}
        </div>
        <div class="form-group">
            <label for="{{ form.email.id_for_label }}">Email</label>
            {{ form.email }}
        </div>

        <div class="box-secao">Dados Profissionais</div>
        <div class="form-group">
            <label for="{{ form.id_funcionario.id_for_label }}">ID do Funcionário</label>
            {{ form.id_funcionario }}
        </div>
        <div class="form-group">
            <label for="{{ form.funcao.id_for_label }}">Função</label>
            {{ form.funcao }}
        </div>
        <div class="form-group">
            <label for="{{ form.departamento.id_for_label }}">Departamento</label>
            {{ form.departamento }}
        </div>
        <div class="form-group">
            <label for="{{ form.status.id_for_label }}">Status</label>
            {{ form.status }}
        </div>
        <div class="form-group">
            <label for="{{ form.data_admissao.id_for_label }}">Data de Admissão</label>
            {{ form.data_admissao }}
        </div>
        <div class="form-group">
            <label for="{{ form.data_mobilizacao.id_for_label }}">Data de Mobilização</label>
            {{ form.data_mobilizacao }}
        </div>
        <div class="form-group">
            <label for="{{ form.data_desligamento.id_for_label }}">Data de Desligamento</label>
            {{ form.data_desligamento }}
        </div>
        <div class="form-group">
            <label for="{{ form.data_desmobilizacao.id_for_label }}">Data de Desmobilização</label>
            {{ form.data_desmobilizacao }}
        </div>
        <div class="form-group">
            <label for="{{ form.cracha_vale.id_for_label }}">Crachá Vale</label>
            {{ form.cracha_vale }}
        </div>

        <button type="submit" class="btn btn-verde mt-3">Cadastrar Funcionário</button>
    </form>
</div>

{% if form.errors %}
    <div class="alert alert-danger">
        <strong>Erro ao cadastrar funcionário!</strong>
        <ul>
            {% for field, errors in form.errors.items %}
                <li><strong>{{ field }}:</strong> {{ errors|striptags }}</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

<script>
    // Atualiza a idade ao inserir a data de nascimento
    document.getElementById('{{ form.data_nascimento.auto_id }}').addEventListener('change', function () {
        let nascimento = new Date(this.value);
        let hoje = new Date();
        let idade = hoje.getFullYear() - nascimento.getFullYear();
        if (hoje.getMonth() < nascimento.getMonth() || (hoje.getMonth() === nascimento.getMonth() && hoje.getDate() < nascimento.getDate())) {
            idade--;
        }
        document.getElementById('idade').value = idade;
    });

    // Atualiza a imagem ao inserir uma nova foto
    document.getElementById('id_foto').addEventListener('change', function (event) {
        const file = event.target.files[0];
        if (file) {
            document.getElementById('foto-label').textContent = file.name;
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('foto-preview').src = e.target.result;
                document.getElementById('foto-preview').style.display = "block";
                document.getElementById('foto-icon').style.display = "none";
            };
            reader.readAsDataURL(file);
        }
    });
</script>

{% endblock %}